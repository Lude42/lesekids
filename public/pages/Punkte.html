<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pilot-Mitteilungsbox – Demo</title>
  <style>
    :root{
      --hud-bg:#0b1220; --card:#0f172a; --ink:#e5e7eb;
      --bdr:#1f2937; --muted:#94a3b8;
      --info:#60a5fa; --ok:#34d399; --warn:#f59e0b; --err:#ef4444;
    }
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg,#0b1220,#0a1020);
      color:var(--ink); font:16px/1.45 system-ui,Segoe UI,Roboto,Arial,sans-serif;
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .demo{
      width:min(860px, 96vw);
      background:#0d1526; border:1px solid #1f2937; border-radius:16px; padding:18px;
      box-shadow:0 12px 36px rgba(0,0,0,.45);
    }
    .demo h1{font-size:18px;margin:0 0 12px}
    .grid{
      display:grid; grid-template-columns: 1fr 1fr; gap:16px;
    }
    .panel{
      background:#0f172a; border:1px solid #1f2937; border-radius:12px; padding:14px;
    }
    .panel h2{font-size:14px;margin:0 0 10px;color:#e2e8f0}
    .row{display:flex; gap:10px; margin:8px 0; align-items:center}
    .row label{min-width:90px; color:#cbd5e1; font-size:13px}
    .row input[type="text"], .row textarea, .row select, .row input[type="number"]{
      flex:1; background:#0b1220; color:#e5e7eb; border:1px solid #1f2937; border-radius:10px; padding:8px;
      font:inherit
    }
    .row textarea{height:80px; resize:vertical}
    .btnbar{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .btn{
      appearance:none; border:1px solid #1f2937; background:#111827; color:#e5e7eb;
      border-radius:10px; padding:8px 12px; cursor:pointer; font-size:14px;
    }
    .btn:hover{filter:brightness(1.08)}
    .hint{color:#94a3b8; font-size:12px; margin-top:8px}

    /* ===== Floating HUD / Messages ===== */
    #pilot-hud{
      position:fixed; left:50%; top:16px; transform:translateX(-50%);
      z-index:9999; display:flex; flex-direction:column; gap:10px;
      pointer-events:none; /* nur Boxen selbst interaktiv */
    }
    .pilot-msg{
      pointer-events:auto;
      min-width:280px; max-width:520px;
      background:var(--card); color:var(--ink); border:1px solid var(--bdr);
      border-radius:14px; padding:10px 12px 12px; box-shadow:0 10px 28px rgba(0,0,0,.45);
      display:grid; grid-template-columns:auto 1fr auto; gap:10px; align-items:start;
      animation: slideIn .24s ease-out;
      position:relative;
    }
    @keyframes slideIn{ from{opacity:0; transform:translate(-2px,-8px)} to{opacity:1; transform:translate(0,0)} }
    .pm-icon{ width:22px; height:22px; margin-top:2px; flex:0 0 auto }
    .pm-body{ display:flex; flex-direction:column; gap:4px }
    .pm-title{ font:700 14px/1.1 system-ui,Segoe UI,Roboto,Arial,sans-serif }
    .pm-text{ font:400 13px/1.35 system-ui,Segoe UI,Roboto,Arial,sans-serif; color:#cbd5e1 }
    .pm-close{ appearance:none; border:0; background:transparent; color:#9aa6b2; cursor:pointer; padding:4px; border-radius:8px }
    .pm-close:hover{ background:#111827; color:#d1d5db }
    .pm-actions{ display:flex; gap:8px; margin-top:4px }
    .pm-btn{
      appearance:none; border:1px solid var(--bdr); background:#111827; color:#e5e7eb; border-radius:10px;
      padding:6px 10px; font-size:12px; cursor:pointer;
    }
    .pm-btn:hover{ filter:brightness(1.08) }
    /* Varianten: Farbleiste links + Iconfarbe */
    .pilot-msg::before{
      content:""; position:absolute; left:0; top:0; bottom:0; width:3px; border-radius:14px 0 0 14px;
      background:var(--info);
    }
    .pilot-msg.ok::before{ background:var(--ok) }
    .pilot-msg.warn::before{ background:var(--warn) }
    .pilot-msg.err::before{ background:var(--err) }
    .pilot-msg .pm-icon svg{ display:block }
    .pilot-msg.ok .pm-icon [data-fill]{ fill:var(--ok) }
    .pilot-msg.warn .pm-icon [data-fill]{ fill:var(--warn) }
    .pilot-msg.err .pm-icon [data-fill]{ fill:var(--err) }
    .pm-timer{ height:3px; background:#111827; border-radius:99px; overflow:hidden; margin-top:6px }
    .pm-timer > i{
      display:block; height:100%; width:100%;
      background:linear-gradient(90deg, var(--info), #a78bfa);
      transform-origin:left center; animation: timer linear forwards;
    }
    .pilot-msg.ok .pm-timer > i{ background:linear-gradient(90deg, var(--ok), #a7f3d0) }
    .pilot-msg.warn .pm-timer > i{ background:linear-gradient(90deg, var(--warn), #fde68a) }
    .pilot-msg.err .pm-timer > i{ background:linear-gradient(90deg, var(--err), #fecaca) }
    @keyframes timer{ from{ transform:scaleX(1) } to{ transform:scaleX(0) } }
  </style>
</head>
<body>

  <!-- Floating HUD target -->
  <div id="pilot-hud" aria-live="polite" aria-atomic="false"></div>

  <!-- Demo Panel -->
  <main class="demo" role="main" aria-labelledby="h1">
    <h1 id="h1">Pilot‑Mitteilungsbox – Demo</h1>
    <div class="grid">
      <section class="panel">
        <h2>Nachricht testen</h2>
        <div class="row">
          <label for="title">Titel</label>
          <input id="title" type="text" placeholder="z. B. Gute Arbeit, Pilot!" value="Gute Arbeit, Pilot!" />
        </div>
        <div class="row">
          <label for="text">Text</label>
          <textarea id="text" placeholder="HTML erlaubt…">Kurs stabil. +<b>10</b> Punkte.</textarea>
        </div>
        <div class="row">
          <label for="variant">Variante</label>
          <select id="variant">
            <option value="info" selected>info</option>
            <option value="ok">ok</option>
            <option value="warn">warn</option>
            <option value="err">err</option>
          </select>
        </div>
        <div class="row">
          <label for="timeout">Timeout</label>
          <input id="timeout" type="number" min="0" step="500" value="4000" /> ms
        </div>
        <div class="btnbar">
          <button class="btn" id="btn-show">Nachricht anzeigen</button>
          <button class="btn" id="btn-stack">3 stapeln</button>
        </div>
        <p class="hint">Tipp: Bewege die Maus über die Box, um den Auto‑Close‑Timer zu pausieren.</p>
      </section>

      <section class="panel">
        <h2>Sofort‑Beispiele</h2>
        <div class="btnbar">
          <button class="btn" data-demo="ok">✅ Erfolg</button>
          <button class="btn" data-demo="warn">⚠️ Warnung</button>
          <button class="btn" data-demo="err">⛔ Fehler</button>
          <button class="btn" data-demo="info">ℹ️ Info</button>
        </div>
        <div style="height:10px"></div>
        <h2>Mit Aktionen</h2>
        <div class="btnbar">
          <button class="btn" id="btn-actions">Mit „Start“-Aktion</button>
        </div>
        <p class="hint">Aktionen sind kleine Buttons innerhalb der Box (z. B. „Start“). Klick schließt die Box.</p>
      </section>
    </div>
  </main>

  <script>
    // ===== Message Center =====
    (function(){
      const hud = document.getElementById('pilot-hud');

      function iconRocket(){
        return `
        <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
          <path data-fill d="M12 2c3 0 6 3.5 7.5 6.5-1.8.7-3.6 1.9-5.1 3.4-1.5 1.5-2.7 3.3-3.4 5.1C8.5 18 5 15 5 12c0-1 .2-2 .7-3L4 7l2-2 2 1c1-.5 2-.7 3-.7Z" fill="#60a5fa"/>
          <circle cx="12.5" cy="8.5" r="2" fill="currentColor" opacity=".5"></circle>
          <path d="M6 18c1.2.6 2.4.9 3.6.9.1 0 .2 0 .3-.1.7-2 1.8-3.9 3.3-5.4s3.5-2.6 5.4-3.3c.1 0 .1-.2.1-.3 0-1.2-.3-2.4-.9-3.6" stroke="rgba(255,255,255,.12)" stroke-width="1" fill="none"></path>
        </svg>`;
      }

      /**
       * showPilotMessage
       * @param {Object} opts
       *  - title: string
       *  - text: string (HTML erlaubt)
       *  - variant: "info"|"ok"|"warn"|"err"  (default "info")
       *  - actions: [{label, onClick}]  optional
       *  - timeout: ms (z.B. 4000). Wenn gesetzt: Auto‑Close + Timerleiste.
       */
      window.showPilotMessage = function(opts={}){
        const {title="Mitteilung", text="", variant="info", actions=[], timeout=0} = opts;
        const box = document.createElement('section');
        box.className = `pilot-msg ${variant === 'ok' ? 'ok' : variant === 'warn' ? 'warn' : variant === 'err' ? 'err' : ''}`;
        box.setAttribute('role', 'status');
        box.innerHTML = `
          <div class="pm-icon">${iconRocket()}</div>
          <div class="pm-body">
            <div class="pm-title">${title}</div>
            ${text ? `<div class="pm-text">${text}</div>` : ``}
            ${timeout ? `<div class="pm-timer"><i style="animation-duration:${timeout}ms"></i></div>` : ``}
            ${actions?.length ? `<div class="pm-actions"></div>` : ``}
          </div>
          <button class="pm-close" aria-label="Schließen">&times;</button>
        `;

        const close = () => {
          box.style.animation = 'none';
          box.animate([{opacity:1, transform:'translateY(0)'},{opacity:0, transform:'translateY(-6px)'}], {duration:180, easing:'ease-out'})
            .addEventListener('finish', ()=> box.remove());
        };

        box.querySelector('.pm-close').addEventListener('click', close);

        // Actions
        if (actions?.length){
          const wrap = box.querySelector('.pm-actions');
          actions.forEach(a=>{
            const btn = document.createElement('button');
            btn.className = 'pm-btn';
            btn.textContent = a.label ?? 'OK';
            btn.addEventListener('click', e=>{
              try { a.onClick?.(e); } catch(_){}
              close();
            });
            wrap.appendChild(btn);
          });
        }

        hud.appendChild(box);

        // Auto close with hover pause
        if (timeout > 0){
          let t = setTimeout(close, timeout);
          let remaining = timeout;
          let start = performance.now();
          const iBar = box.querySelector('.pm-timer > i');

          const pause = () => {
            clearTimeout(t);
            const elapsed = performance.now() - start;
            remaining = Math.max(0, remaining - elapsed);
            if (iBar){
              const comp = getComputedStyle(iBar).animationDuration;
              const durMs = parseFloat(comp) * (comp.includes('ms') ? 1 : 1000);
              const doneRatio = 1 - (remaining / (durMs || timeout));
              iBar.style.animationPlayState = 'paused';
              iBar.style.transform = `scaleX(${Math.max(0, 1 - doneRatio)})`;
            }
          };
          const resume = () => {
            start = performance.now();
            t = setTimeout(close, remaining);
            if (iBar){
              iBar.style.animation = 'none';
              requestAnimationFrame(()=>{
                iBar.style.animation = `timer linear forwards`;
                iBar.style.animationDuration = `${remaining}ms`;
              });
            }
          };

          box.addEventListener('mouseenter', pause);
          box.addEventListener('mouseleave', resume);
        }

        return box;
      };
    })();

    // ===== Demo Controls =====
    (function(){
      const $ = (sel)=>document.querySelector(sel);
      const title = $('#title');
      const text  = $('#text');
      const variant = $('#variant');
      const timeout = $('#timeout');

      $('#btn-show').addEventListener('click', ()=>{
        showPilotMessage({
          title: title.value || 'Mitteilung',
          text: text.value || '',
          variant: variant.value,
          timeout: Math.max(0, Number(timeout.value)||0)
        });
      });

      $('#btn-stack').addEventListener('click', ()=>{
        const v = variant.value;
        const t = Math.max(0, Number(timeout.value)||0) || 3500;
        ['Erste Nachricht','Zweite Nachricht','Dritte Nachricht'].forEach((name, i)=>{
          setTimeout(()=>showPilotMessage({
            title: name,
            text: `Variante <b>${v}</b> – Stapel #${i+1}`,
            variant: v,
            timeout: t
          }), i*250);
        });
      });

      document.querySelectorAll('[data-demo]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const type = btn.getAttribute('data-demo');
          showPilotMessage({
            title: type==='ok' ? 'Alles im grünen Bereich' :
                   type==='warn' ? 'Achtung, Kursabweichung' :
                   type==='err' ? 'Systemfehler' : 'Info',
            text: type==='ok' ? 'Manöver erfolgreich abgeschlossen.' :
                  type==='warn' ? 'Bitte Werte prüfen und erneut versuchen.' :
                  type==='err' ? 'Navigation ausgefallen – Neustart erforderlich.' :
                  'Neue Missionsdaten eingetroffen.',
            variant: type,
            timeout: 4200
          });
        });
      });

      $('#btn-actions').addEventListener('click', ()=>{
        showPilotMessage({
          title: 'Nächste Mission bereit',
          text: 'Willst du direkt starten?',
          variant: 'info',
          actions: [
            { label: 'Start', onClick: ()=> alert('Mission gestartet! 🚀') },
            { label: 'Später' }
          ],
          timeout: 0
        });
      });
    })();
  </script>
</body>
</html>
